<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Europa XS Build Log</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 2rem; background: #f8f8f8; }
  h1 { text-align: center; margin-bottom: 2rem; }
  h2 { background: #eee; padding: 0.5rem 1rem; border-radius: 8px; }
  .category { margin-bottom: 2rem; }
  .entry { background: white; margin: 1rem 0; padding: 1rem; border-radius: 0.5rem; }
  .entry h3 { margin-top: 0; }
  .photos { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 0.5rem; }
  .photos img { height: 120px; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
  .photos img:hover { transform: scale(1.05); }
</style>
</head>
<body>
<h1>Europa XS Build Log</h1>
<div id="content"></div>

<script>
fetch("logs.json")
  .then(r => r.json())
  .then(data => {
    const container = document.getElementById("content");

    // Group entries by category
    const byCategory = {};
    data.forEach(entry => {
      if (!entry.category) return;
      if (!byCategory[entry.category]) byCategory[entry.category] = [];
      byCategory[entry.category].push(entry);
    });

    // Sort categories alphabetically
    const categories = Object.keys(byCategory).sort();

    categories.forEach(cat => {
      const section = document.createElement("div");
      section.className = "category";
      section.innerHTML = `<h2>${cat}</h2>`;

      // Sort entries by date (oldest to newest)
      byCategory[cat].sort((a, b) => new Date(a.created) - new Date(b.created));

      byCategory[cat].forEach(entry => {
        const div = document.createElement("div");
        div.className = "entry";
        const title = entry.title || "(no title)";
        const summary = entry.summary || "";
        const date = entry.created || "";
        div.innerHTML = `<h3>${title}</h3><small>${date}</small><p>${summary}</p>`;

        // Show attached photos
        if (entry.assets && entry.assets.length > 0) {
          const photosDiv = document.createElement("div");
          photosDiv.className = "photos";

          entry.assets.forEach(photo => {
            const path = encodeURI(photo.filename.trim().replace(/^\.\/| \//g, "/"));


            if (path) {
              const img = document.createElement("img");
              img.src = path;
              img.onclick = () => window.open(img.src, "_blank");
              photosDiv.appendChild(img);
            }
          });

          div.appendChild(photosDiv);
        }

        section.appendChild(div);
      });

      container.appendChild(section);
    });
  })
  .catch(err => {
    console.error("Error loading logs.json", err);
    document.getElementById("content").innerHTML = "<p>Could not load build log data.</p>";
  });
</script>
</body>
</html>
