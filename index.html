<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Europa XS Build Log</title>
<style>
body { font-family: sans-serif; margin: 2rem; background:#f8f8f8; }
h1 { text-align: center; }
.category { margin-top: 2rem; background: white; padding: 1rem; border-radius: 1rem; }
.entry { margin: 1rem 0; padding: 1rem; background: #fff; border: 1px solid #ddd; border-radius: 0.5rem; }
.entry h3 { margin: 0 0 .3rem 0; }
.photos img { height: 120px; margin: 4px; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
.photos img:hover { transform: scale(1.1); }
</style>
</head>
<body>
<h1>Europa XS Build Log</h1>
<div id="content"></div>

<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
Papa.parse("logs.csv", {
  download: true,
  header: true,
  complete: function(results) {
    let data = results.data.filter(e => e.Category && e.Title);

    // Sort by Created date (oldest first)
    data.sort((a, b) => new Date(a.Created) - new Date(b.Created));

    // Group by Category
    const byCategory = {};
    data.forEach(row => {
      if (!row.Category) return;
      byCategory[row.Category] = byCategory[row.Category] || [];
      byCategory[row.Category].push(row);
    });

    const container = document.getElementById("content");

    for (const [cat, entries] of Object.entries(byCategory)) {
      const section = document.createElement("div");
      section.className = "category";
      section.innerHTML = `<h2>${cat}</h2>`;

      entries.forEach(e => {
        const div = document.createElement("div");
        div.className = "entry";
        const title = e.Title || "(no title)";
        const summary = e.Summary || "";
        const date = e.Created || "";
        div.innerHTML = `<h3>${title}</h3>
                         <small>${date}</small>
                         <p>${summary}</p>`;

        // --- PHOTO SECTION ---
        const photoCount = parseInt(e["Assets Count"]) || 0;
        if (photoCount > 0) {
          const photosDiv = document.createElement("div");
          photosDiv.className = "photos";

          // Try to load the photo by ID (matches your export format)
          const img = document.createElement("img");
          img.src = `Photo Assets/${cat}/${e.ID}.jpg`;
          img.onerror = () => img.remove();
          img.onclick = () => window.open(img.src, "_blank");
          photosDiv.appendChild(img);

          div.appendChild(photosDiv);
        }

        section.appendChild(div);
      });
      container.appendChild(section);
    }
  }
});
</script>
</body>
</html>
