<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Roy Giorgio's EuropaXS Build</title>
<style>
  body { font-family: system-ui, sans-serif; margin: 2rem; background: #f8f8f8; }
  h1 { text-align: center; margin-bottom: 0.5rem; }
  #stats { text-align: center; color: #555; margin-bottom: 2rem; }

  h2 { background: #eee; padding: 0.5rem 1rem; border-radius: 8px; }
  .category { margin-bottom: 2rem; }
  .entry { background: white; margin: 1rem 0; padding: 1rem; border-radius: 0.5rem; }
  .entry h3 { margin-top: 0; }
  .photos { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 0.5rem; }
  .photos img { height: 120px; border-radius: 8px; cursor: pointer; transition: transform 0.2s; }
  .photos img:hover { transform: scale(1.05); }

  /* Sort dropdown */
  #sort-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 2rem;
  }
  #sort-select {
    padding: 0.4rem 0.6rem;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
  }

  /* --- lightbox --- */
  #lightbox {
    display: none;
    position: fixed;
    z-index: 9999;
    inset: 0;
    background: rgba(0,0,0,0.9);
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }
  #lightbox img {
    max-height: 90vh;
    max-width: 90vw;
    border-radius: 8px;
  }
  #lightbox .nav {
    position: absolute;
    top: 50%;
    font-size: 3rem;
    color: white;
    cursor: pointer;
    user-select: none;
    padding: 0 1rem;
  }
  #lightbox .nav:hover { color: #ccc; }
  #lightbox #prev { left: 0; }
  #lightbox #next { right: 0; }
  #lightbox #close {
    position: absolute;
    top: 1rem;
    right: 1.5rem;
    font-size: 2rem;
    color: white;
    cursor: pointer;
  }
  #caption {
    color: #ccc;
    font-size: 1rem;
    margin-top: 0.5rem;
    max-width: 90vw;
    text-align: center;
  }
</style>
</head>
<body>
<h1>Roy Giorgio's EuropaXS Build</h1>

<div id="stats">
  <span>Start date: Apr 17, 2025</span> • 
  <span>Total hours: <span id="total-hours">84h 45m</span></span> • 
  <span id="last-updated"></span>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const lastModified = new Date(document.lastModified);
    const formatted = lastModified.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'short',
      day: 'numeric'
    });
    document.getElementById('last-updated').textContent = `Last updated: ${formatted}`;
  });
</script>

<div id="sort-controls">
  <label for="sort-select">Sort by:</label>
  <select id="sort-select">
    <option value="date-desc">Newest first</option>
    <option value="date-asc">Oldest first</option>
    <option value="category">Category</option>
    <option value="hours">Hours</option>
  </select>
</div>

<div id="content"></div>

<!-- Lightbox -->
<div id="lightbox">
  <span id="close">&times;</span>
  <span id="prev" class="nav">&#10094;</span>
  <img id="lightbox-img" src="" alt="">
  <span id="next" class="nav">&#10095;</span>
  <div id="caption"></div>
</div>

<!-- KitFlight data loading script -->
<script>
fetch("logs.json")
  .then(res => res.json())
  .then(logs => {
    const content = document.getElementById("content");

    function renderEntries(entries) {
      content.innerHTML = "";
      entries.forEach(entry => {
        const div = document.createElement("div");
        div.className = "entry";

       let date;
if (/\d{4}-\d{2}-\d{2}/.test(entry.created)) {
  // ISO format (2025-04-17)
  date = new Date(entry.created);
} else if (/\d{1,2}\/\d{1,2}\/\d{4}/.test(entry.created)) {
  // US format (4/17/2025)
  const [m, d, y] = entry.created.split('/');
  date = new Date(y, m - 1, d);
} else {
  // Try to parse as text (Apr 17, 2025)
  date = new Date(Date.parse(entry.created));
}

const formattedDate = isNaN(date)
  ? entry.created
  : date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });



        div.innerHTML = `
          <h3>${formattedDate} — ${entry.title || ""}</h3>
          <p><em>${entry.category || ""}</em></p>
          <p>${entry.text || ""}</p>
          ${entry.photos && entry.photos.length ? `
            <div class="photos">
              ${entry.photos.map((photo, i) => `
                <img src="${photo.url}" alt="${photo.caption || ''}" data-index="${i}" data-photos='${JSON.stringify(entry.photos)}'>
              `).join('')}
            </div>` : ""}
          <p><strong>Time spent:</strong> ${entry.time || ""}</p>
        `;
        content.appendChild(div);
      });
    }

    renderEntries(logs);

    // Sorting
    const sortSelect = document.getElementById("sort-select");
    sortSelect.addEventListener("change", () => {
      let sorted = [...logs];
      if (sortSelect.value === "date-asc") {
        sorted.sort((a, b) => new Date(a.created) - new Date(b.created));
      } else if (sortSelect.value === "date-desc") {
        sorted.sort((a, b) => new Date(b.created) - new Date(a.created));
      } else if (sortSelect.value === "category") {
        sorted.sort((a, b) => (a.category || "").localeCompare(b.category || ""));
      } else if (sortSelect.value === "hours") {
        sorted.sort((a, b) => (parseFloat(b.time) || 0) - (parseFloat(a.time) || 0));
      }
      renderEntries(sorted);
    });
  })
  .catch(err => {
    console.error("Error loading logs.json", err);
    document.getElementById("content").innerHTML = "<p>Could not load build log data.</p>";
  });
</script>
</body>
</html>
