<body>
  <h1>Europa XS Build Log</h1>

  <div id="sort-controls">
    <div class="sort-row">
      <label for="sort-categories">Sort categories:</label>
      <select id="sort-categories">
        <option value="date-desc">Date (Newest → Oldest)</option>
        <option value="date-asc">Date (Oldest → Newest)</option>
        <option value="category-asc">Category (A → Z)</option>
        <option value="category-desc">Category (Z → A)</option>
      </select>

      <label for="jump-category">Jump to category:</label>
      <select id="jump-category"></select>
    </div>

    <div class="sort-row">
      <label for="sort-entries">Sort entries within category:</label>
      <select id="sort-entries">
        <option value="date-desc">Date (Newest → Oldest)</option>
        <option value="date-asc">Date (Oldest → Newest)</option>
      </select>
    </div>
  </div>

  <div id="log"></div>

  <button id="back-to-top">↑ Back to Top</button>

  <script>
    // Load JSON
    fetch('logs.json')
      .then(response => response.json())
      .then(data => {
        const logContainer = document.getElementById('log');
        const jumpSelect = document.getElementById('jump-category');
        const sortCategoriesSelect = document.getElementById('sort-categories');
        const sortEntriesSelect = document.getElementById('sort-entries');

        function renderLogs(sortCat = 'date-desc', sortEntries = 'date-desc') {
          logContainer.innerHTML = '';

          let categories = Object.keys(data);

          // Category sorting
          if (sortCat === 'date-desc' || sortCat === 'date-asc') {
            categories.sort((a, b) => {
              const aDate = new Date(data[a][0]?.date || 0);
              const bDate = new Date(data[b][0]?.date || 0);
              return sortCat === 'date-desc' ? bDate - aDate : aDate - bDate;
            });
          } else {
            categories.sort((a, b) =>
              sortCat === 'category-asc' ? a.localeCompare(b) : b.localeCompare(a)
            );
          }

          // Populate jump dropdown
          jumpSelect.innerHTML = '';
          categories.forEach(cat => {
            const opt = document.createElement('option');
            opt.value = cat;
            opt.textContent = cat;
            jumpSelect.appendChild(opt);
          });

          // Render categories collapsed
          categories.forEach(cat => {
            const catDiv = document.createElement('div');
            catDiv.className = 'category';
            catDiv.id = `cat-${cat}`;

            const catHeader = document.createElement('h2');
            catHeader.textContent = cat;
            catHeader.className = 'category-header';
            catHeader.addEventListener('click', () => {
              entriesDiv.classList.toggle('open');
            });

            const entriesDiv = document.createElement('div');
            entriesDiv.className = 'entries-container';

            // Sort entries
            let entries = data[cat];
            entries.sort((a, b) => {
              const da = new Date(a.date);
              const db = new Date(b.date);
              return sortEntries === 'date-desc' ? db - da : da - db;
            });

            entries.forEach(entry => {
              const entryDiv = document.createElement('div');
              entryDiv.className = 'entry';
              entryDiv.innerHTML = `
                <h3>${entry.title}</h3>
                <p><strong>Date:</strong> ${entry.date}</p>
                <p><strong>Hours:</strong> ${entry.hours}</p>
                <p>${entry.description}</p>
                <div class="photos">
                  ${(entry.photos || [])
                    .map(photo => `<img src="${photo}" alt="${entry.title} photo">`)
                    .join('')}
                </div>
              `;
              entriesDiv.appendChild(entryDiv);
            });

            catDiv.appendChild(catHeader);
            catDiv.appendChild(entriesDiv);
            logContainer.appendChild(catDiv);
          });
        }

        // Initial render
        renderLogs();

        // Event listeners
        sortCategoriesSelect.addEventListener('change', () =>
          renderLogs(sortCategoriesSelect.value, sortEntriesSelect.value)
        );
        sortEntriesSelect.addEventListener('change', () =>
          renderLogs(sortCategoriesSelect.value, sortEntriesSelect.value)
        );

        jumpSelect.addEventListener('change', e => {
          const target = document.getElementById(`cat-${e.target.value}`);
          if (target) {
            // Expand selected category
            const entriesDiv = target.querySelector('.entries-container');
            entriesDiv.classList.add('open');

            target.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // Change sort to alphabetical when jumping
            sortCategoriesSelect.value = 'category-asc';
            renderLogs('category-asc', sortEntriesSelect.value);
          }
        });

        // Back to top
        document.getElementById('back-to-top').addEventListener('click', () =>
          window.scrollTo({ top: 0, behavior: 'smooth' })
        );
      });
  </script>

  <style>
    body {
      font-family: system-ui, sans-serif;
      line-height: 1.5;
      margin: 2rem;
    }

    #sort-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.8rem;
      margin-bottom: 2rem;
    }

    .sort-row {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .category {
      margin-bottom: 2rem;
    }

    .category-header {
      cursor: pointer;
      background: #f0f0f0;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      transition: background 0.3s;
    }

    .category-header:hover {
      background: #e0e0e0;
    }

    .entries-container {
      display: none;
      margin-top: 0.5rem;
    }

    .entries-container.open {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-5px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .entry {
      background: white;
      margin: 1rem 0;
      padding: 1rem;
      border-radius: 0.5rem;
      box-shadow: 0 0 4px rgba(0, 0, 0, 0.1);
    }

    .entry h3 {
      margin-top: 0;
    }

    .photos {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-top: 0.5rem;
    }

    .photos img {
      height: 120px;
      border-radius: 8px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .photos img:hover {
      transform: scale(1.05);
    }

    #back-to-top {
      display: block;
      margin: 2rem auto;
      padding: 0.5rem 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
      cursor: pointer;
      background: #f8f8f8;
    }

    #back-to-top:hover {
      background: #eee;
    }
  </style>
</body>
